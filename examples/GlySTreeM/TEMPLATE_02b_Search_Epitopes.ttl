@prefix ex: <https://glyconnect.expasy.org/glystreem/.well-known/sparql-examples> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <https://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
ex:TEMPLATE_02b_Search_Epitopes a sh:SPARQLExecutable, sh:SPARQLSelectExecutable ;
  sh:prefixes _:sparql_examples_prefixes , _:glystreem_example_prefixes ;
  rdfs:comment ''' Template_02b Search for a particular Epitope''' ;
  schema:target <https://glyconnect.expasy.org/glystreem/sparql> ;
  sh:select '''
PREFIX glystreem: <https://glyconnect.expasy.org/rdf/structures#>
PREFIX modl: <https://archive.org/services/purl/domain/modular_ontology_design_library/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT DISTINCT ?epitope ?name ?glytoucanID ?source (COUNT(DISTINCT ?glycan) AS ?glycanCount)
WHERE 
	{
		# VALUES ?source {"Cummings"}
		# VALUES ?source {"UniLectin"}
		?epitope a glystreem:Epitope;
			glystreem:epitopeName ?name ;
			glystreem:epitopeSource ?source .
		OPTIONAL {?epitope glystreem:epitope_glytoucanID ?glytoucanID}
		# Replace "blood group h" with the epitope that you are interested in (NB small letters only) e.g. lactosamine
		FILTER(CONTAINS(lcase(str(?name)), lcase("blood group h")))
		OPTIONAL {
			?glycan a glystreem:Glycan ;
				glystreem:hasEpitopeSet/^modl:bagitemOf ?epitope .}
	}
GROUP BY ?epitope ?name ?glytoucanID ?source ''' .
